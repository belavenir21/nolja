<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - í”¼ë“œë°±</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css'); body { font-family: 'Pretendard', sans-serif; }</style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-2">ğŸ“Š ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        <p class="text-gray-400 mb-8">ìœ ì €ë“¤ì´ ë‚¨ê¸´ í”¼ë“œë°±ì„ ëª¨ì•„ë´…ë‹ˆë‹¤.</p>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                <div class="text-gray-400 text-sm">ì´ í”¼ë“œë°± ìˆ˜</div>
                <div class="text-4xl font-bold text-blue-400" id="totalCount">0</div>
            </div>
            <div class="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                <div class="text-gray-400 text-sm">í‰ê·  ë³„ì </div>
                <div class="text-4xl font-bold text-yellow-400" id="avgRating">0.0</div>
            </div>
            <div class="bg-gray-800 p-6 rounded-2xl border border-gray-700">
                <div class="text-gray-400 text-sm">ëˆ„ì  ë°©ë¬¸ì</div>
                <div class="text-4xl font-bold text-green-400" id="visitorCount">0</div>
            </div>
        </div>

        <h2 class="text-xl font-bold mb-4">ğŸ“ ìµœê·¼ í›„ê¸° ëª©ë¡</h2>
        <div id="feedbackList" class="space-y-4">
            <div class="text-center text-gray-500 py-10">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <script>
        // ğŸ‘‡ ê´€ë¦¬ì ì ‘ì† ì•”í˜¸ ì„¤ì • (ì›í•˜ëŠ” ê±¸ë¡œ ë°”ê¾¸ì„¸ìš”)
        const ADMIN_PASSWORD = "yushi0405!"; 

        const password = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        if (password !== ADMIN_PASSWORD) {
            alert("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
            location.href = "index.html"; // ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¬ë©´ ë©”ì¸ìœ¼ë¡œ ì«“ì•„ëƒ„
        }

        // âœ… ë³¸ì¸ ì„¤ì •ê°’ìœ¼ë¡œ ë®ì–´ì“°ì„¸ìš”!
        const firebaseConfig = {
            apiKey: "AIzaSyDvtMrhYYEqpJEjwhBzEiyKgBhmcoLKROM",
            authDomain: "spyfall-b107.firebaseapp.com",
            databaseURL: "https://spyfall-b107-default-rtdb.firebaseio.com",
            projectId: "spyfall-b107",
            storageBucket: "spyfall-b107.firebasestorage.app",
            messagingSenderId: "35799604494",
            appId: "1:35799604494:web:9558db68aa6c5347d60b5f",
            measurementId: "G-HYQR22H174"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ë°©ë¬¸ì ìˆ˜ ê°€ì ¸ì˜¤ê¸°
        db.ref('analytics/total_visits').on('value', snap => {
            document.getElementById('visitorCount').innerText = snap.val() || 0;
        });

        // í”¼ë“œë°± ê°€ì ¸ì˜¤ê¸°
        db.ref('feedbacks').on('value', snap => {
            const data = snap.val();
            const listEl = document.getElementById('feedbackList');
            listEl.innerHTML = '';

            if (!data) {
                listEl.innerHTML = '<div class="text-center text-gray-500 py-10">ì•„ì§ ë“±ë¡ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            const items = Object.values(data).reverse(); // ìµœì‹ ìˆœ ì •ë ¬
            
            // í†µê³„ ê³„ì‚°
            document.getElementById('totalCount').innerText = items.length;
            const avg = items.reduce((acc, cur) => acc + cur.rating, 0) / items.length;
            document.getElementById('avgRating').innerText = avg.toFixed(1);

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'bg-gray-800 p-5 rounded-xl border border-gray-700 flex gap-4';
                div.innerHTML = `
                    <div class="text-3xl">${item.rating >= 4 ? 'ğŸ˜' : (item.rating >= 3 ? 'ğŸ™‚' : 'ğŸ¤¬')}</div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-yellow-400 font-bold">${'â­'.repeat(item.rating)}</span>
                            <span class="text-xs text-gray-500">${item.date}</span>
                        </div>
                        <p class="text-gray-300 text-sm leading-relaxed">${item.comment || '<span class="text-gray-600">(ë‚´ìš© ì—†ìŒ)</span>'}</p>
                    </div>
                `;
                listEl.appendChild(div);
            });
        });
    </script>
</body>
</html>