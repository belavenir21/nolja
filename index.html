<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SPYFALL - ì˜¨ë¼ì¸ ìŠ¤íŒŒì´ ê²Œì„</title>
    
    <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ì•„ì´ì½˜ -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; background-color: #111827; color: white; -webkit-tap-highlight-color: transparent; }
        .spy-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .modal-enter { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ğŸ”¥ [ì¤‘ìš”] ì—¬ê¸°ì— ë³¸ì¸ì˜ Firebase ì„¤ì •ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” ğŸ”¥
        const firebaseConfig = {
            apiKey: "AIzaSyDvtMrhYYEqpJEjwhBzEiyKgBhmcoLKROM",
            authDomain: "spyfall-b107.firebaseapp.com",
            databaseURL: "https://spyfall-b107-default-rtdb.firebaseio.com",
            projectId: "spyfall-b107",
            storageBucket: "spyfall-b107.firebasestorage.app",
            messagingSenderId: "35799604494",
            appId: "1:35799604494:web:9558db68aa6c5347d60b5f",
            measurementId: "G-HYQR22H174"
        };
        
        // Firebase ì´ˆê¸°í™”
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // ê²Œì„ ë°ì´í„° (ì¥ì†Œ ë° ì§ì—…)
        const GAME_DATA = {
            hospital: { place: "ğŸ¥ ì¢…í•©ë³‘ì›", roles: ["ì™¸ê³¼ ì˜ì‚¬", "ìˆ˜ê°„í˜¸ì‚¬", "ì‘ê¸‰ í™˜ì", "ë³‘ì›ì¥", "êµ¬ê¸‰ëŒ€ì›", "ì•½ì‚¬", "ì²­ì†Œë¶€", "ë³´í˜¸ì"] },
            school: { place: "ğŸ« ê³ ë“±í•™êµ", roles: ["ë‹´ì„ ì„ ìƒë‹˜", "ì „êµ íšŒì¥", "ì²´ìœ¡ ì„ ìƒë‹˜", "êµì¥ ì„ ìƒë‹˜", "ë§¤ì  ì´ëª¨", "ì ìëŠ” í•™ìƒ", "ì „í•™ìƒ", "ì–‘í˜¸ ì„ ìƒë‹˜"] },
            airplane: { place: "âœˆï¸ ë¹„í–‰ê¸°", roles: ["ê¸°ì¥", "ìŠ¹ë¬´ì›", "ì¼ë“±ì„ ìŠ¹ê°", "ìš°ëŠ” ì•„ê¸°", "ê¸°ë‚´ì‹ ìš”ë¦¬ì‚¬", "í•­ê³µ ë³´ì•ˆê´€", "ì •ë¹„ì‚¬", "ë¶€ê¸°ì¥"] },
            pirate: { place: "ğŸ´â€â˜ ï¸ í•´ì ì„ ", roles: ["í•´ì  ì„ ì¥", "ìš©ê°í•œ ì„ ì›", "í¬ë¡œ", "ìš”ë¦¬ì‚¬", "ì¡°íƒ€ìˆ˜", "ê°‘íŒì¥", "ì•µë¬´ìƒˆ", "ë§ì›ê²½ ë³´ëŠ” ì„ ì›"] },
            movie: { place: "ğŸ¬ ì˜í™” ì´¬ì˜ì¥", roles: ["ì˜í™” ê°ë…", "ì£¼ì—° ë°°ìš°", "ìŠ¤í„´íŠ¸ë§¨", "ì¹´ë©”ë¼ ê°ë…", "ë¶„ì¥ì‚¬", "ì—‘ìŠ¤íŠ¸ë¼", "ì‘ê°€", "ì¡°ëª… ê°ë…"] },
            casino: { place: "ğŸ° ì¹´ì§€ë…¸", roles: ["ë”œëŸ¬", "ë¶€ì ì†ë‹˜", "ë³´ì•ˆ ìš”ì›", "ë§¤ë‹ˆì €", "ëˆ ìƒì€ ì†ë‹˜", "ë°”í…ë”", "íƒ€ì§œ", "ì²­ì†Œë¶€"] },
            space: { place: "ğŸš€ ìš°ì£¼ ì •ê±°ì¥", roles: ["ìš°ì£¼ ë¹„í–‰ì‚¬", "í•¨ì¥", "ì™¸ê³„ì¸ ì—°êµ¬ì›", "ì—”ì§€ë‹ˆì–´", "ìš°ì£¼ ê´€ê´‘ê°", "AI ë¡œë´‡", "ì˜ë¬´ê´€", "í†µì‹  ì¥êµ"] },
            army: { place: "â›º êµ°ë¶€ëŒ€", roles: ["ì§€íœ˜ê´€", "ì‹ ë³‘", "ì·¨ì‚¬ë³‘", "ì¡°êµ", "ì˜ë¬´ë³‘", "íƒˆì˜ë³‘", "í–‰ë³´ê´€", "ì‚¬ê²© êµê´€"] },
            opera: { place: "ğŸ­ ì˜¤í˜ë¼ í•˜ìš°ìŠ¤", roles: ["ì˜¤í˜ë¼ ê°€ìˆ˜", "ì§€íœ˜ì", "ì—°ì£¼ì", "VIP ê´€ê°", "ë¬´ëŒ€ ê°ë…", "ì•ˆë‚´ì›", "ë§¤í‘œì†Œ ì§ì›", "ì¡°ëª… ê¸°ì‚¬"] },
            camping: { place: "â›º ìº í•‘ì¥", roles: ["ê³ ê¸° êµ½ëŠ” ì•„ë¹ ", "ë›°ì–´ë…¸ëŠ” ì•„ì´", "ìº í•‘ì¥ ì£¼ì¸", "ìˆ  ì·¨í•œ ëŒ€í•™ìƒ", "ê¸°íƒ€ ì¹˜ëŠ” ì‚¬ëŒ", "ëª¨ê¸° ë¬¼ë¦° ì‚¬ëŒ", "ì¥ì‘ íŒŒëŠ” ì‚¬ëŒ", "ì˜† í…íŠ¸ ì»¤í”Œ"] },
            cruise: { place: "ğŸš¢ í¬ë£¨ì¦ˆ ìœ ëŒì„ ", roles: ["ì„ ì¥", "ë°”í…ë”", "ë§ˆìˆ ì‚¬", "ì‹ í˜¼ë¶€ë¶€", "ê°‘ë¶€ ë…¸ì¸", "ìˆ˜ì˜ì¥ ì•ˆì „ìš”ì›", "ì¹´ì§€ë…¸ ë”œëŸ¬", "ê°ì‹¤ ì²­ì†Œë¶€"] },
            bank: { place: "ğŸ¦ ì€í–‰", roles: ["ì€í–‰ ê°•ë„", "ì§€ì ì¥", "ì°½êµ¬ ì§ì›", "ëŒ€ì¶œ ìƒë‹´ ë°›ìœ¼ëŸ¬ ì˜¨ ì‚¬ëŒ", "ì²­ì› ê²½ì°°", "ATM ìˆ˜ë¦¬ê¸°ì‚¬", "í˜„ê¸ˆ ìˆ˜ì†¡ ìš”ì›", "VIP ê³ ê°"] }
        };

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        const generateRoomCode = () => Math.random().toString(36).substring(2, 6).toUpperCase();
        const generateUserId = () => 'user_' + Math.random().toString(36).substring(2, 15);
        const getRandomLocation = () => {
            const keys = Object.keys(GAME_DATA);
            return GAME_DATA[keys[Math.floor(Math.random() * keys.length)]];
        };

        // --- ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸ ---
        function App() {
            // ìœ ì € ìƒíƒœ
            const [userId] = useState(() => {
                const stored = localStorage.getItem('spyfall_user_id');
                if (stored) return stored;
                const newId = generateUserId();
                localStorage.setItem('spyfall_user_id', newId);
                return newId;
            });

            // ê²Œì„ ìƒíƒœ
            const [view, setView] = useState('lobby'); // lobby, room, game, result
            const [roomId, setRoomId] = useState('');
            const [nickname, setNickname] = useState(localStorage.getItem('spyfall_nickname') || '');
            const [roomData, setRoomData] = useState(null);
            const [error, setError] = useState('');
            
            // UI ìƒíƒœ
            const [messages, setMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [showRoleModal, setShowRoleModal] = useState(false);
            const [showResultModal, setShowResultModal] = useState(false);
            
            const chatEndRef = useRef(null);

            // ë‹‰ë„¤ì„ ì €ì¥
            useEffect(() => { if (nickname) localStorage.setItem('spyfall_nickname', nickname); }, [nickname]);

            // ì•„ì´ì½˜ ë Œë”ë§
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [view, showRoleModal, showResultModal]);

            // ì±„íŒ… ìŠ¤í¬ë¡¤ ìë™ ì´ë™
            useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages, showRoleModal]);

            // ê²Œì„ ì‹œì‘ ì‹œ ì—­í•  íŒì—… ìë™ ì˜¤í”ˆ
            useEffect(() => {
                if (roomData?.status === 'playing') {
                    setShowRoleModal(true);
                    setShowResultModal(false);
                } else if (roomData?.status === 'finished') {
                    setShowResultModal(true);
                    setShowRoleModal(false);
                }
            }, [roomData?.status]);

            // ë°© ë°ì´í„° & ì±„íŒ… ë¦¬ìŠ¤ë„ˆ
            useEffect(() => {
                if (!roomId) return;

                const roomRef = database.ref('rooms/' + roomId);
                const chatRef = database.ref('rooms/' + roomId + '/messages');

                // 1. ë°© ì •ë³´ êµ¬ë…
                const roomListener = roomRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        setRoomData(data);
                        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— í˜„ì¬ ë°© ì €ì¥ (ìƒˆë¡œê³ ì¹¨ ëŒ€ë¹„)
                        localStorage.setItem('spyfall_current_room', roomId);
                    } else {
                        alert('ë°©ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        leaveRoomCleanup();
                    }
                });

                // 2. ì±„íŒ… êµ¬ë…
                const chatListener = chatRef.limitToLast(50).on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) setMessages(Object.values(data));
                    else setMessages([]);
                });

                // 3. ìë™ í‡´ì¥ ì„¤ì •
                const myPlayerRef = database.ref('rooms/' + roomId + '/players/' + userId);
                myPlayerRef.onDisconnect().remove();

                return () => {
                    roomRef.off('value', roomListener);
                    chatRef.off('value', chatListener);
                    myPlayerRef.onDisconnect().cancel();
                };
            }, [roomId]);

            // --- ì•¡ì…˜ í•¸ë“¤ëŸ¬ ---

            const leaveRoomCleanup = async () => {
                if (roomId) {
                    await database.ref('rooms/' + roomId + '/players/' + userId).remove();
                    localStorage.removeItem('spyfall_current_room');
                    setRoomId('');
                    setRoomData(null);
                    setMessages([]);
                    setView('lobby');
                }
            };

            const handleCreateRoom = async () => {
                if (!nickname.trim()) return setError('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”');
                const newId = generateRoomCode();
                await database.ref('rooms/' + newId).set({
                    hostId: userId,
                    players: { [userId]: { uid: userId, name: nickname, role: null, isSpy: false } },
                    status: 'waiting',
                    createdAt: Date.now()
                });
                setRoomId(newId);
                setView('room');
            };

            const handleJoinRoom = async () => {
                if (!nickname.trim() || !roomId.trim()) return setError('ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”');
                const targetId = roomId.toUpperCase();
                const snap = await database.ref('rooms/' + targetId).once('value');
                const data = snap.val();
                
                if (!data) return setError('ì—†ëŠ” ë°©ì…ë‹ˆë‹¤');
                if (Object.keys(data.players || {}).length >= 12) return setError('ë°©ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤');

                await database.ref(`rooms/${targetId}/players/${userId}`).set({
                    uid: userId, name: nickname, role: null, isSpy: false
                });
                setRoomId(targetId);
                setView('room');
            };

            const handleStartGame = async () => {
                const players = Object.values(roomData.players || {});
                if (players.length < 3) return alert('ìµœì†Œ 3ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤');

                const location = getRandomLocation();
                let roles = [...location.roles].sort(() => Math.random() - 0.5);
                const spyIndex = Math.floor(Math.random() * players.length);
                const updatedPlayers = {};

                players.forEach((p, idx) => {
                    updatedPlayers[p.uid] = {
                        ...p,
                        role: idx === spyIndex ? 'SPY' : roles.pop() || 'ì‹œë¯¼',
                        isSpy: idx === spyIndex
                    };
                });

                await database.ref('rooms/' + roomId).update({
                    status: 'playing',
                    locationName: location.place,
                    players: updatedPlayers,
                    messages: null // ìƒˆ ê²Œì„ ì‹œì‘ ì‹œ ì±„íŒ… ì´ˆê¸°í™” (ì„ íƒì‚¬í•­)
                });
            };

            const handleEndGame = async () => {
                await database.ref('rooms/' + roomId).update({ status: 'finished' });
            };

            const handleRestart = async () => {
                const players = Object.values(roomData.players || {});
                const resetPlayers = {};
                players.forEach(p => resetPlayers[p.uid] = { ...p, role: null, isSpy: false });

                await database.ref('rooms/' + roomId).update({
                    status: 'waiting',
                    locationName: null,
                    players: resetPlayers
                });
            };

            const sendMessage = async (e) => {
                e.preventDefault();
                if (!chatInput.trim()) return;
                await database.ref(`rooms/${roomId}/messages`).push({
                    sender: nickname,
                    text: chatInput,
                    timestamp: Date.now()
                });
                setChatInput('');
            };

            const copyCode = () => {
                navigator.clipboard ? navigator.clipboard.writeText(roomId).then(() => alert('ë³µì‚¬ì™„ë£Œ')) : prompt("ë°© ì½”ë“œ", roomId);
            };

            // --- ë Œë”ë§ ì»´í¬ë„ŒíŠ¸ ---

            const ChatComponent = () => (
                <div className="flex flex-col h-48 bg-black/20 rounded-xl border border-white/10 mt-4">
                    <div className="flex-1 overflow-y-auto p-3 space-y-2 text-sm">
                        {messages.length === 0 && <div className="text-white/30 text-center text-xs">ì±„íŒ…ì„ ì‹œì‘í•´ë³´ì„¸ìš”</div>}
                        {messages.map((msg, i) => (
                            <div key={i} className="text-white">
                                <span className="font-bold text-yellow-400 mr-2">{msg.sender}:</span>
                                <span className="text-white/90">{msg.text}</span>
                            </div>
                        ))}
                        <div ref={chatEndRef} />
                    </div>
                    <form onSubmit={sendMessage} className="p-2 border-t border-white/10 flex gap-2">
                        <input 
                            value={chatInput} 
                            onChange={e => setChatInput(e.target.value)} 
                            className="flex-1 bg-white/10 rounded px-2 py-1 text-sm text-white focus:outline-none"
                            placeholder="ë©”ì‹œì§€ ì…ë ¥..." 
                        />
                        <button type="submit" className="bg-blue-600 px-3 py-1 rounded text-sm font-bold">ì „ì†¡</button>
                    </form>
                </div>
            );

            // --- ë·° ë Œë”ë§ ---

            if (view === 'lobby') {
                return (
                    <div className="min-h-screen spy-gradient flex items-center justify-center p-6">
                        <div className="w-full max-w-sm bg-white/10 backdrop-blur-lg p-8 rounded-3xl border border-white/10 shadow-2xl">
                            <h1 className="text-5xl font-black text-center text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-yellow-500 mb-2">SPYFALL</h1>
                            <p className="text-center text-gray-400 mb-8">ì˜¨ë¼ì¸ ìŠ¤íŒŒì´ ê²Œì„</p>
                            
                            <input value={nickname} onChange={e => setNickname(e.target.value)} placeholder="ë‹‰ë„¤ì„" className="w-full bg-black/40 border border-white/20 rounded-xl p-4 text-white mb-4 outline-none focus:border-red-500" />
                            {error && <div className="text-red-400 text-sm text-center mb-4">{error}</div>}
                            
                            <button onClick={handleCreateRoom} className="w-full bg-red-600 hover:bg-red-700 py-4 rounded-xl font-bold mb-3 shadow-lg">ë°© ë§Œë“¤ê¸°</button>
                            <div className="flex gap-2">
                                <input value={roomId} onChange={e => setRoomId(e.target.value.toUpperCase())} placeholder="ë°© ì½”ë“œ" maxLength={4} className="flex-1 bg-black/40 border border-white/20 rounded-xl p-4 text-center uppercase text-white outline-none" />
                                <button onClick={handleJoinRoom} className="flex-1 bg-blue-600 hover:bg-blue-700 py-4 rounded-xl font-bold shadow-lg">ì°¸ê°€</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'room' || view === 'game' || view === 'result') {
                if (!roomData) return <div className="min-h-screen spy-gradient flex items-center justify-center">ë¡œë”© ì¤‘...</div>;
                const players = Object.values(roomData.players || {});
                const isHost = roomData.hostId === userId;
                const me = roomData.players[userId];
                
                // ì •ì²´ ê³µê°œ ëª¨ë‹¬
                if (showResultModal) {
                    return (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 modal-enter">
                            <div className="bg-gray-800 w-full max-w-md rounded-3xl p-6 border border-white/20 shadow-2xl max-h-[90vh] overflow-y-auto">
                                <h2 className="text-3xl font-black text-center mb-6 text-yellow-400">ğŸ•µï¸ ì •ì²´ ê³µê°œ</h2>
                                <div className="space-y-3 mb-6">
                                    {players.map(p => (
                                        <div key={p.uid} className={`flex justify-between items-center p-3 rounded-xl ${p.isSpy ? 'bg-red-900/50 border border-red-500/50' : 'bg-white/5 border border-white/10'}`}>
                                            <span className="font-bold">{p.name} {p.uid === userId && '(ë‚˜)'}</span>
                                            <span className={`font-bold ${p.isSpy ? 'text-red-400' : 'text-blue-300'}`}>
                                                {p.isSpy ? 'ìŠ¤íŒŒì´ ğŸ•µï¸' : p.role}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                                <div className="text-center text-gray-400 mb-4 text-sm">ì¥ì†Œ: <span className="text-white font-bold">{roomData.locationName}</span></div>
                                {isHost ? (
                                    <button onClick={handleRestart} className="w-full bg-green-600 hover:bg-green-700 py-4 rounded-xl font-bold text-lg">ìƒˆ ê²Œì„ ì‹œì‘</button>
                                ) : (
                                    <div className="text-center text-gray-500">ë°©ì¥ì´ ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ê¸¸ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
                                )}
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="min-h-screen spy-gradient p-4 pb-24">
                        <div className="max-w-md mx-auto">
                            {/* ìƒë‹¨ ë°” */}
                            <div className="flex justify-between items-center bg-black/40 p-4 rounded-2xl border border-white/10 backdrop-blur-md sticky top-0 z-10">
                                <div>
                                    <div className="text-xs text-gray-400">ROOM CODE</div>
                                    <div className="text-2xl font-black text-yellow-400 tracking-widest">{roomId}</div>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={copyCode} className="bg-white/10 p-2 rounded-lg"><i data-lucide="copy" className="w-5 h-5"></i></button>
                                    <button onClick={leaveRoomCleanup} className="bg-red-500/20 text-red-300 p-2 rounded-lg text-xs font-bold border border-red-500/30">ë‚˜ê°€ê¸°</button>
                                </div>
                            </div>

                            {/* ì—­í•  í™•ì¸ ë²„íŠ¼ (ê²Œì„ ì¤‘ì¼ ë•Œë§Œ) */}
                            {roomData.status === 'playing' && (
                                <button onClick={() => setShowRoleModal(true)} className="w-full mt-4 bg-gradient-to-r from-indigo-500 to-purple-600 py-3 rounded-xl font-bold shadow-lg animate-pulse">
                                    ğŸƒ ë‚´ ì—­í•  ì¹´ë“œ í™•ì¸í•˜ê¸°
                                </button>
                            )}

                            {/* ì—­í•  ëª¨ë‹¬ (íŒì—…) */}
                            {showRoleModal && me && (
                                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4" onClick={() => setShowRoleModal(false)}>
                                    <div className={`w-full max-w-sm p-8 rounded-3xl text-center shadow-2xl border-4 scale-100 transition-transform ${me.isSpy ? 'bg-red-900 border-red-500' : 'bg-blue-900 border-blue-500'}`} onClick={e => e.stopPropagation()}>
                                        <div className="text-6xl mb-4">{me.isSpy ? 'ğŸ¤«' : 'ğŸ“'}</div>
                                        <h2 className="text-2xl font-bold mb-2">{me.isSpy ? 'ë‹¹ì‹ ì€ ìŠ¤íŒŒì´!' : 'ë‹¹ì‹ ì˜ ì—­í• '}</h2>
                                        {me.isSpy ? (
                                            <p className="text-red-200">ì¥ì†Œë¥¼ ëª¨ë¦…ë‹ˆë‹¤.<br/>ëˆˆì¹˜ê» í–‰ë™í•˜ì„¸ìš”!</p>
                                        ) : (
                                            <div>
                                                <div className="text-4xl font-black text-white mb-6">{me.role}</div>
                                                <div className="border-t border-white/20 pt-4">
                                                    <div className="text-xs text-blue-200">í˜„ì¬ ì¥ì†Œ</div>
                                                    <div className="text-2xl font-bold text-yellow-300">{roomData.locationName}</div>
                                                </div>
                                            </div>
                                        )}
                                        <button onClick={() => setShowRoleModal(false)} className="mt-8 w-full bg-black/30 hover:bg-black/50 py-3 rounded-xl font-bold border border-white/20">
                                            ë‹«ê¸°
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* ì±„íŒ…ì°½ */}
                            <ChatComponent />

                            {/* ì°¸ê°€ì ëª©ë¡ */}
                            <div className="mt-4 bg-black/20 rounded-2xl p-4 border border-white/5">
                                <h3 className="text-xs font-bold text-gray-400 mb-3 uppercase">ì°¸ê°€ì ({players.length}ëª…)</h3>
                                <div className="grid grid-cols-2 gap-2">
                                    {players.map(p => (
                                        <div key={p.uid} className={`p-2 rounded-lg text-center text-sm ${p.uid === userId ? 'bg-white text-black font-bold' : 'bg-white/5 text-gray-300'}`}>
                                            {p.name} {p.uid === roomData.hostId && 'ğŸ‘‘'}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* ë°©ì¥ ì»¨íŠ¸ë¡¤ */}
                            {isHost && (
                                <div className="fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-gray-900 via-gray-900 to-transparent">
                                    <div className="max-w-md mx-auto">
                                        {roomData.status === 'playing' ? (
                                            <button onClick={handleEndGame} className="w-full bg-red-600 hover:bg-red-700 py-4 rounded-2xl font-bold shadow-xl text-lg border border-red-400">
                                                ğŸ›‘ ê²Œì„ ì¢…ë£Œ ë° ì •ì²´ ê³µê°œ
                                            </button>
                                        ) : (
                                            <button onClick={handleStartGame} disabled={players.length < 3} className="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-700 py-4 rounded-2xl font-bold shadow-xl text-lg">
                                                ê²Œì„ ì‹œì‘ ({players.length}/3ëª… ì´ìƒ)
                                            </button>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }
            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>